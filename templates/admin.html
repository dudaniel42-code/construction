{% extends 'base.html' %}
{% block content %}
    <section class="admin-panel">
        <h2>Admin Panel</h2>
        <p>Total Plans: {{ plan_count }}</p>
        <h3>Upload New Plan</h3>
        <form method="POST" action="{{ url_for('admin.upload_plan') }}" enctype="multipart/form-data">
            <input type="text" name="title" placeholder="Plan Title" required>
            <textarea name="description" placeholder="Plan Description" required></textarea>
            <input type="file" name="image" accept="image/*" required>
            <label><input type="checkbox" name="sold"> Mark as Sold</label>
            <button type="submit">Upload Plan</button>
        </form>
        <h3>Existing Plans</h3>
        <ul>
            {% for plan in plans %}
                <li>
                    <img src="{{ url_for('static', filename='uploads/' + plan.image_path) }}" alt="{{ plan.title }}">
                    {{ plan.title }} {% if plan.sold %}<span style="color: red; font-weight: bold;">SOLD</span>{% endif %}
                    <a href="{{ url_for('main.plan_detail', id=plan.id) }}">View</a>
                    <form method="POST" action="{{ url_for('admin.delete', id=plan.id) }}" style="display: inline;">
                        <button type="submit" onclick="return confirm('Delete {{ plan.title }}?')">Delete</button>
                    </form>
                    <form method="POST" action="{{ url_for('admin.edit', id=plan.id) }}" style="display: inline;">
                        <input type="text" name="title" value="{{ plan.title }}" required>
                        <textarea name="description" required>{{ plan.description }}</textarea>
                        <label><input type="checkbox" name="sold" {% if plan.sold %}checked{% endif %}> Sold</label>
                        <button type="submit">Edit</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    </section>
{% endblock %}